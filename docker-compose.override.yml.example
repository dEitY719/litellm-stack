# ═══════════════════════════════════════════════════════════════════════════════
# docker-compose.override.yml (Internal PC용 - 회사 내부)
# ═══════════════════════════════════════════════════════════════════════════════
#
# 이 파일은 Internal 환경(회사 내부 네트워크, 프록시)에서만 사용됩니다.
#
# 사용 방법:
# 1. 이 파일을 docker-compose.override.yml로 복사
# 2. samsungsemi-prx.com.crt를 준비
# 3. .env 파일에서 LITELLM_ENV=internal로 설정
# 4. docker compose up -d 실행
#
# 주의: 이 파일은 .gitignore에 등록되어 커밋되지 않습니다.
# ═══════════════════════════════════════════════════════════════════════════════

services:
  litellm:
    # ─────────────────────────────────────────────────────
    # Dockerfile 빌드 (CA 인증서 포함)
    # ─────────────────────────────────────────────────────
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # 빌드 타입: home | internal
        # internal로 설정하면 CA 인증서와 SSL 검증 비활성화 포함
        BUILD_TYPE: internal

    # ─────────────────────────────────────────────────────
    # Root 권한 (CA 인증서 설치, Prisma 초기화용)
    # ─────────────────────────────────────────────────────
    user: "0:0"

    # ─────────────────────────────────────────────────────
    # 캐시 볼륨 (Prisma, Python 캐시)
    # ─────────────────────────────────────────────────────
    volumes:
      - ./litellm_settings.yml:/app/config.yml
      - litellm_cache:/app/.cache

    # ─────────────────────────────────────────────────────
    # 환경변수
    # ─────────────────────────────────────────────────────
    environment:
      # 애플리케이션 경로 설정
      HOME: /app
      XDG_CACHE_HOME: /app/.cache

      # LiteLLM 설정
      DATABASE_URL: "postgresql://llmproxy:dbpassword9090@db:5432/litellm"
      STORE_MODEL_IN_DB: "True"
      LITELLM_MASTER_KEY: "sk-4444"

      # ⚠️ Internal 필수: SSL 검증 비활성화
      # (회사 프록시/방화벽 대응, 동료 검증 완료)
      LITELLM_SSL_VERIFY: "False"

    # ─────────────────────────────────────────────────────
    # 재시작 정책
    # ─────────────────────────────────────────────────────
    restart: always

# ═══════════════════════════════════════════════════════════════════════════════
# 데이터 볼륨 정의
# ═══════════════════════════════════════════════════════════════════════════════
volumes:
  litellm_cache:
    name: litellm_cache
    external: true
